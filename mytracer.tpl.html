<head>

<style>
.toggler {cursor: pointer}
.line.visited {background: rgba(255,255,0,0.1); }
.inlined { border:1px silver solid; }
.code { font-family: monospace;  }
.line-code { font-family: monospace;  white-space: pre;}

.button{
    display: inline-block;
    /* background: #ff0;
    padding: 8px 12px;
     */
    border: 1px solid silver;
    border-radius: 4px;
    
    cursor: pointer;
    
}

.button:hover{
    background: white;
}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
// var call_map = {{..}};
// var visited_lines = {{visited_lines}};
</script>


<script>

$(document).ready(function(){

    
   // jQuery methods go here...
   $(".inlined").hide();
   
   $first_code =  $("#codes .code").first();
    
   $("#trace").prepend( $first_code.html() );
   

   $(".line.visited .line-code").each(
        function(){  
            var title = $(this).parent().prop('id');
            this.title = title;
    });

   $(".toggler").each(
        function(){  
            call_id = this.id.substr(  "toggler_".length );
            this.title = call_id;
    });
   
});




function get_inlined_jq( toggler ){
        var id = toggler.id;
        call_id = id.substr(  "toggler_".length );

        // get corresponding closest container?
        return $(toggler).siblings("#inlined_"+call_id).first();
}

function style_inlined( toggler, prop, val ){
    $target = get_inlined_jq(toggler);
    $target.css( prop, val );
}

function smart_toggle( toggler ){

        toggler = (typeof toggler !== 'undefined') ?  toggler : this;   // defaults to "this" -- element calling the function
        
        $target = get_inlined_jq(toggler);
        if ($target.is(":visible")) $target.hide();
        else show_inlined($target);
    
}


function show_inlined($container){
    
    var id = $container.prop('id');
    var call_id = id.substr(  "inlined_".length );
 
    var $code = $("#code_"+call_id).first();  // take from #codes list
    
    if($container.text().trim()=="") // if empty
    {
        // $container.append(  $code.html() ); // TODO: attr('innerHTML')?? should take initial stuff
        $container.append(  $code.prop('outerHTML') ); // TODO: attr('innerHTML')?? should take initial stuff
    }
        
    $container.show();
}

</script>

</head>

<body>

<h2>call_map:</h2>
<pre>
{{call_map}}
</pre>

<h2>visited_lines:</h2>
<pre>
{{visited_lines}}
</pre>

<h2>Trace:</h2>
<div id="trace">



<pre>

<span class="line">bla bla
</span>

<span class="line calee" id="lineID_mymodule_123">boo boo 
<span class="toggler" id="toggler_X">*</span> 
<span class="toggler" id="toggler_____main__-Z">*</span>
<span class="toggler" id="toggler_Y">*</span> 

<span class="inlined" id="inlined_____main__-Z"></span>
<span class="inlined" id="inlined_X"></span>
<span class="inlined" id="inlined_Y">.Y.</span>
</span>

</div>


    <h2>Codes</h2>
<div id="codes">
{{codes}}


<pre id="code_X">asdf</pre>
<pre id="code_____main__-Z">code_____main__-Z</pre>

</div>


</body>
