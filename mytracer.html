<head>

<style>
.toggler {cursor: pointer}
.line.visited {background: rgba(255,255,125,0.5); }
.code { font-family: monospace; border:1px silver solid; }
.line-code { font-family: monospace;  white-space: pre;}

.button{
    display: inline-block;
    /* background: #ff0;
    padding: 8px 12px;
     */
    border: 1px solid silver;
    border-radius: 4px;
    
    cursor: pointer;
    
}

.button:hover{
    background: white;
}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
// var call_map = {{..}};
// var visited_lines = ['__main__-340', '__main__-341', '__main__-342', '__main__-343', '__main__-353', '__main__-354', '__main__-344', '__main__-345', '__main__-324', '__main__-325', '__main__-326', '__main__-328', '__main__-331', '__main__-333', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-336', '__main__-350'];
</script>


<script>

$(document).ready(function(){

    
   // jQuery methods go here...
   $(".inlined").hide();
   
   $first_code =  $("#codes .code").first();
    
   $("#trace").prepend( $first_code.html() );
   
   $(".line.visited").each(
        function(){  
            this.title = this.id;
    });
   
});


function smart_toggle( toggler ){

        toggler = (typeof toggler !== 'undefined') ?  toggler : this;   // defaults to "this" -- element calling the function
        
        $toggler = $(toggler);
        
        var id = toggler.id;
        call_id = id.substr(  "toggler_".length );

        // get corresponding closest container?
        var $target = $toggler.siblings("#inlined_"+call_id).first();
        if ($target.is(":visible")) $target.hide();
        else show_inlined($target);
    
}


function show_inlined($container){
    
    var id = $container.prop('id');
    var call_id = id.substr(  "inlined_".length );
 
    var $code = $("#code_"+call_id).first();  // take from #codes list
    
    if($container.text().trim()=="") // if empty
    {
        // $container.append(  $code.html() ); // TODO: attr('innerHTML')?? should take initial stuff
        $container.append(  $code.prop('outerHTML') ); // TODO: attr('innerHTML')?? should take initial stuff
    }
        
    $container.show();
}

</script>

</head>

<body>

<h2>call_map:</h2>
<pre>
{
    "__main__-372": [
        "__main__-B"
    ],
    "__main__-343": [
        "__main__-C"
    ],
    "__main__-345": [
        "__main__-A"
    ],
    "__main__-333": [
        "__main__-C"
    ],
    "__main__-335": [
        "__main__-C"
    ]
}
</pre>

<h2>visited_lines:</h2>
<pre>
['__main__-340', '__main__-341', '__main__-342', '__main__-343', '__main__-353', '__main__-354', '__main__-344', '__main__-345', '__main__-324', '__main__-325', '__main__-326', '__main__-328', '__main__-331', '__main__-333', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-335', '__main__-353', '__main__-354', '__main__-334', '__main__-336', '__main__-350']
</pre>

<h2>Trace:</h2>
<div id="trace">



<pre>

<span class="line">bla bla
</span>

<span class="line calee" id="lineID_mymodule_123">boo boo 
<span class="toggler" id="toggler_X">*</span> 
<span class="toggler" id="toggler_____main__-Z">*</span>
<span class="toggler" id="toggler_Y">*</span> 

<span class="inlined" id="inlined_____main__-Z"></span>
<span class="inlined" id="inlined_X"></span>
<span class="inlined" id="inlined_Y">.Y.</span>
</span>

</div>


    <h2>Codes</h2>
<div id="codes">

    <h4>__main__-B</h4>
    <div id='code___main__-B' class='code'>
    <div id='__main__-339' class='line '><span class="line-code">def B(): </span>   
</div><div id='__main__-340' class='line visited'><span class="line-code">           print("start B")</span>   
</div><div id='__main__-341' class='line visited'><span class="line-code">           x = 42  </span>   
</div><div id='__main__-342' class='line visited'><span class="line-code">           u = (A(</span>   
</div><div id='__main__-343' class='line visited'><span class="line-code">             x=C() ,</span>   
<span class='toggler button' onclick='smart_toggle(this)' id='toggler___main__-C'>&#8597;</span>

<div class='inlined' id='inlined___main__-C' style="margin-left: 13ch;"></div></div><div id='__main__-344' class='line visited'><span class="line-code">             y=3,</span>   
</div><div id='__main__-345' class='line visited'><span class="line-code">              z=2</span>   
<span class='toggler button' onclick='smart_toggle(this)' id='toggler___main__-A'>&#8597;</span>

<div class='inlined' id='inlined___main__-A' style="margin-left: 14ch;"></div></div><div id='__main__-346' class='line '><span class="line-code">                      </span>   
</div><div id='__main__-347' class='line '><span class="line-code">           )</span>   
</div><div id='__main__-348' class='line '><span class="line-code">           )</span>   
</div><div id='__main__-349' class='line '><span class="line-code">                </span>   
</div><div id='__main__-350' class='line visited'><span class="line-code">           print("end B")</span>   
</div>
    </div>
        


    <h4>__main__-C</h4>
    <div id='code___main__-C' class='code'>
    <div id='__main__-352' class='line '><span class="line-code">def C():</span>   
</div><div id='__main__-353' class='line visited'><span class="line-code">         print("C")</span>   
</div><div id='__main__-354' class='line visited'><span class="line-code">         return 2</span>   
</div>
    </div>
        


    <h4>__main__-A</h4>
    <div id='code___main__-A' class='code'>
    <div id='__main__-323' class='line '><span class="line-code">def A(*args, **kwargs): </span>   
</div><div id='__main__-324' class='line visited'><span class="line-code">     a = 5</span>   
</div><div id='__main__-325' class='line visited'><span class="line-code">     print(</span>   
</div><div id='__main__-326' class='line visited'><span class="line-code">       "A"</span>   
</div><div id='__main__-327' class='line '><span class="line-code">       )</span>   
</div><div id='__main__-328' class='line visited'><span class="line-code">     if a > 10:</span>   
</div><div id='__main__-329' class='line '><span class="line-code">         print("a > 10")</span>   
</div><div id='__main__-330' class='line '><span class="line-code">     else:</span>   
</div><div id='__main__-331' class='line visited'><span class="line-code">         print("a <= 10")</span>   
</div><div id='__main__-332' class='line '><span class="line-code">        </span>   
</div><div id='__main__-333' class='line visited'><span class="line-code">     c = C()</span>   
<span class='toggler button' onclick='smart_toggle(this)' id='toggler___main__-C'>&#8597;</span>

<div class='inlined' id='inlined___main__-C' style="margin-left: 5ch;"></div></div><div id='__main__-334' class='line visited'><span class="line-code">     for x in range(3):</span>   
</div><div id='__main__-335' class='line visited'><span class="line-code">         C()</span>   
<span class='toggler button' onclick='smart_toggle(this)' id='toggler___main__-C'>&#8597;</span>

<div class='inlined' id='inlined___main__-C' style="margin-left: 9ch;"></div></div><div id='__main__-336' class='line visited'><span class="line-code">     return a</span>   
</div>
    </div>
        


<pre id="code_X">asdf</pre>
<pre id="code_____main__-Z">code_____main__-Z</pre>

</div>


</body>
